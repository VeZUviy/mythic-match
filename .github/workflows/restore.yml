name: 4. Restore Structure

on:
  workflow_dispatch: # –ó–∞–ø—É—Å–∫ –∫–Ω–æ–ø–∫–æ—é –≤—Ä—É—á–Ω—É

permissions:
  contents: write

jobs:
  fix_structure:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Sort Files Correctly
        run: |
          # –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ Git
          git config --global user.name "Repair Bot"
          git config --global user.email "bot@github.com"

          echo "–ü–æ—á–∏–Ω–∞—é —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è..."

          # 1. –°—Ç–≤–æ—Ä—é—î–º–æ –≥–æ–ª–æ–≤–Ω—ñ –ø–∞–ø–∫–∏ (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫, —è–∫—â–æ –≤–æ–Ω–∏ –∑–Ω–∏–∫–ª–∏)
          mkdir -p sounds
          mkdir -p fone

          # 2. –†—è—Ç—É—î–º–æ –ú–£–ó–ò–ö–£
          # –Ø–∫—â–æ –ø–∞–ø–∫–∏ –ª–µ–∂–∞—Ç—å —É –∫–æ—Ä–µ–Ω—ñ, –ø–µ—Ä–µ–º—ñ—â—É—î–º–æ —ó—Ö —É sounds/
          # –ü–µ—Ä–µ–ª—ñ–∫ –ø–∞–ø–æ–∫ –∑ –≤–∞—à–æ–≥–æ —Å–∫—Ä—ñ–Ω—à–æ—Ç—É
          for dir in ice jungle iron ruins chaos element; do
            if [ -d "$dir" ]; then
              echo "–ó–Ω–∞–π–¥–µ–Ω–æ –ø–∞–ø–∫—É $dir –Ω–µ –Ω–∞ –º—ñ—Å—Ü—ñ. –ü–µ—Ä–µ–º—ñ—â—É—é –≤ sounds/..."
              # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ rsync –¥–ª—è –∑–ª–∏—Ç—Ç—è (–±–µ–∑–ø–µ—á–Ω—ñ—à–µ –Ω—ñ–∂ mv –¥–ª—è –ø–∞–ø–æ–∫)
              rsync -av --remove-source-files "$dir"/ sounds/"$dir"/
              rm -rf "$dir"
            fi
          done

          # 3. –†—è—Ç—É—î–º–æ –§–û–ù–ò
          # –ü–∞–ø–∫–∏ story —Ç–∞ nonstory –º–∞—é—Ç—å –±—É—Ç–∏ –≤ fone/
          for dir in story nonstory; do
            if [ -d "$dir" ]; then
              echo "–ó–Ω–∞–π–¥–µ–Ω–æ –ø–∞–ø–∫—É $dir –Ω–µ –Ω–∞ –º—ñ—Å—Ü—ñ. –ü–µ—Ä–µ–º—ñ—â—É—é –≤ fone/..."
              rsync -av --remove-source-files "$dir"/ fone/"$dir"/
              rm -rf "$dir"
            fi
          done

          # –Ø–∫—â–æ boss.jpg –≤–∏–ø–∞–≤ —É –∫–æ—Ä—ñ–Ω—å - –∫–∏–¥–∞—î–º–æ –≤ fone
          if [ -f "boss.jpg" ]; then mv boss.jpg fone/; fi

          # 4. –†—è—Ç—É—î–º–æ –ö–û–î (—è–∫—â–æ –≤—ñ–Ω —Ä–∞–ø—Ç–æ–º –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –ø–∞–ø–∫–∏ 'code' —á–∏ 'www')
          # –®—É–∫–∞—î–º–æ, –¥–µ —Å—Ö–æ–≤–∞–≤—Å—è index.html (—è–∫—â–æ –≤—ñ–Ω –Ω–µ –≤ –∫–æ—Ä–µ–Ω—ñ)
          find . -mindepth 2 -name "index.html" | while read filepath; do
            parent_dir=$(dirname "$filepath")
            echo "–ö–æ–¥ –∑–Ω–∞–π–¥–µ–Ω–æ —É $parent_dir. –í–∏—Ç—è–≥—É—é –Ω–∞–≥–æ—Ä—É..."
            mv "$parent_dir"/* .
            rm -rf "$parent_dir"
          done

          # 5. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          git add .
          
          # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –±—É–ª–∏ –∑–º—ñ–Ω–∏
          if ! git diff-index --quiet HEAD; then
            git commit -m "üîß –°—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ (Repair Bot)"
            git push
            echo "–£—Å–ø—ñ—Ö! –ü–∞–ø–∫–∏ —Ä–æ–∑–∫–ª–∞–¥–µ–Ω–æ –ø–æ –º—ñ—Å—Ü—è—Ö."
          else
            echo "–ó–º—ñ–Ω –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ, –≤—Å–µ –≤–∂–µ —Å—Ç–æ—ó—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ."
          fi
