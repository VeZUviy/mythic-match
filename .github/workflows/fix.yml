name: 3. Fix Directories

on:
  workflow_dispatch: # –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É –∫–Ω–æ–ø–∫–æ—é

permissions:
  contents: write

jobs:
  organize_files:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Move files to Root
        run: |
          # –ù–∞–ª–∞—à—Ç–æ–≤—É—î–º–æ Git
          git config --global user.name "Fix Bot"
          git config --global user.email "bot@github.com"

          # 1. –®—É–∫–∞—î–º–æ —ñ –≤–∏—Ç—è–≥—É—î–º–æ –∫–æ–¥ (index.html, js, css)
          # –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ñ–∞–π–ª index.html, —è–∫–∏–π –ª–µ–∂–∏—Ç—å –Ω–µ –≤ –∫–æ—Ä–µ–Ω—ñ
          find . -mindepth 2 -name "index.html" | while read filepath; do
            dir=$(dirname "$filepath")
            echo "–ó–Ω–∞–π–¥–µ–Ω–æ –≥—Ä—É –≤ –ø–∞–ø—Ü—ñ: $dir. –ü–µ—Ä–µ–º—ñ—â—É—é..."
            mv "$dir"/* .
            # –Ø–∫—â–æ –ø–∞–ø–∫–∞ —Å—Ç–∞–ª–∞ –ø—É—Å—Ç–æ—é - –≤–∏–¥–∞–ª—è—î–º–æ
            rmdir "$dir" || true
          done

          # 2. –®—É–∫–∞—î–º–æ —ñ –≤–∏—Ç—è–≥—É—î–º–æ –ø–∞–ø–∫—É fone
          # –Ø–∫—â–æ fone –ª–µ–∂–∏—Ç—å –¥–µ—Å—å –≥–ª–∏–±–æ–∫–æ, –ø–µ—Ä–µ–º—ñ—â—É—î–º–æ —ó—ó –≤–º—ñ—Å—Ç —É –ø—Ä–∞–≤–∏–ª—å–Ω—É –ø–∞–ø–∫—É fone
          mkdir -p fone
          find . -mindepth 2 -type d -name "fone" | while read dir; do
             echo "–ó–Ω–∞–π–¥–µ–Ω–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤: $dir. –û–±'—î–¥–Ω—É—é..."
             cp -r "$dir"/* fone/
             rm -rf "$dir"
          done

          # 3. –®—É–∫–∞—î–º–æ —ñ –≤–∏—Ç—è–≥—É—î–º–æ –ø–∞–ø–∫—É sounds
          mkdir -p sounds
          find . -mindepth 2 -type d -name "sounds" | while read dir; do
             echo "–ó–Ω–∞–π–¥–µ–Ω–æ –º—É–∑–∏–∫—É –≤: $dir. –û–±'—î–¥–Ω—É—é..."
             cp -r "$dir"/* sounds/
             rm -rf "$dir"
          done

          # 4. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Ä—è–¥–æ–∫
          git add .
          
          if ! git diff-index --quiet HEAD; then
            git commit -m "üßπ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ"
            git push
          else
            echo "–í—Å–µ –≤–∂–µ —Å—Ç–æ—ó—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ!"
          fi
